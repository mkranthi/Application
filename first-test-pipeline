pipeline {
  agent any
  parameters {
    choice(name: 'select_environment', choices: ['dev', 'test', 'prod'], description: 'Choose one')
    gitParameter branchFilter: 'origin/(.*)', defaultValue: 'main', name: 'BRANCH', type: 'PT_BRANCH', useRepository: '.*Application.git'
  }
  stages {
    stage('Example') {
      steps {
         echo "Branch Choice: ${params.select_environment}"
        git branch: "${params.BRANCH}", url: 'https://github.com/mkranthi/Application.git'
      }
    }
    stage('selcet env'){
        steps {
            when {
                expression { env.BRANCH_NAME != 'dev'}
                }
                echo ' hello from dev '
                script {
                    sh '''
                    #!/bin/bash
                    config=$(jq '.dev.ip' config.json | cut -c 2-14)
                    echo $config
                    ssh -i /tmp/id_rsa ec2-user@$config -o StrictHostKeyChecking=no uname -a; exit 0'''
                }
            }
    }                 
    stage('selcet environment'){
        steps {
            when {
                expression { env.BRANCH_NAME != 'test'}
                }
                echo ' hello from test '
                script {
                    sh '''
                    #!/bin/bash
                    config=$(jq '.test.ip' config.json | cut -c 2-14)
                    echo $config
                    ssh -i /tmp/id_rsa ec2-user@$config -o StrictHostKeyChecking=no uname -a; exit 0'''
                }
            }

        }     
    }
         }
